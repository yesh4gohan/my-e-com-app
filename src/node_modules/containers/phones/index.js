import React, { Component } from 'react'
import PropTypes from 'prop-types'
import { connect } from 'react-redux'
import {fetchPhones,loadMorePhones,addToCart} from "actions";
import {getPhones} from "selectors";
import {Link} from "react-router";
export class Phones extends Component {

  constructor(){
    super();
    this.state = {
      phones : []
    };
  }
  async componentDidMount(){
      await this.props.fetchPhones();
      this.setState({phones:this.props.phones});
  }
  componentWillReceiveProps(nextProps){
    this.setState({phones:nextProps.phones});
  }
  renderPhones = (phone,index) => {
    const shortDescription = `${phone.description.substr(0,40)} ...`;
    const {addToCart} = this.props;
    return (
      <div className='col-sm-4 col-lg-4 col-md-4 book-list' key={index}>
        <div className='thumbnail'>
          <img
            className='img-thumbnail'
            src={phone.image}
            alt={phone.name}
          />
          <div className='caption'>
            <h4 className='pull-right'>${phone.price}</h4>
            <h4>
              <Link to={`/phone/${phone.id}`}>
                {phone.name}
              </Link>
            </h4>
            <p>{shortDescription}</p>
            <p className='itemButton'>
              <button
                className='btn btn-primary'
                onClick = {() => {addToCart(phone.id)}}
              >
                Buy Now!
              </button>
              <Link 
                to={`/phone/${phone.id}`}
                className='btn btn-default'
              >
                More info
              </Link>
            </p>
          </div>
        </div>
      </div>
    )
  }
  render() {
      const {loadMorePhones} = this.props;
      const {phones} = this.state;
    return (
      <div>
      <div className = "books row">
        {phones.map((phone,index) =>this.renderPhones(phone,index))}
      </div>
      <div className = "col-md-12">
        <button
        className = "pull-right btn btn-primary"
        onClick = {()=>{loadMorePhones(phones.length)}}
        >
        Load More
        </button>
      </div>
      </div>
    )
  }
}

const mapStateToProps = (state) => ({
  phones: getPhones(state)
})

const mapDispatchToProps = {
  fetchPhones,
  loadMorePhones,
  addToCart
}

export default connect(mapStateToProps, mapDispatchToProps)(Phones)
